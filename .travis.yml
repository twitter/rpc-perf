language: rust
os: linux
dist: trusty
sudo: required
cache: cargo
matrix:
  fast_finish: true
  include:
    - os: linux
      rust: stable
      env: TYPE=default
      script:
        - bash build/ci.sh
    - os: linux
      rust: stable
      env: FEATURES=tls PACKAGE=rpc-perf
      script:
        - bash build/ci.sh
    - os: linux
      rust: stable
      env: TYPE=rustfmt RUST_BACKTRACE=1
      script:
        - rustup component add rustfmt --toolchain stable
        - cargo +stable fmt -- --check
    - os: linux
      rust: nightly
      env: TYPE=clippy RUST_BACKTRACE=1
      script:
        - rustup toolchain install nightly-2020-05-01
        - rustup component add clippy --toolchain nightly-2020-05-01
        - cargo +nightly-2020-05-01 clippy
        - cd rpc-perf
        - cargo +nightly-2020-05-01 clippy --features tls
